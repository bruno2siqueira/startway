<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Registro de Problema</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5 mb-5">
  <h2 class="mb-4">ğŸ“‹ Etapa 1 â€“ Registro do Problema</h2>

  <form id="formProblema" novalidate>

    <!-- DescriÃ§Ã£o Detalhada -->
    <div class="mb-3">
      <label for="descricao" class="form-label">DescriÃ§Ã£o Detalhada *</label>
      <textarea class="form-control" id="descricao" rows="4" required placeholder="Explique o problema com detalhes..."></textarea>
      <div class="form-text">VocÃª pode gravar sua descriÃ§Ã£o por Ã¡udio:</div>

      <!-- BotÃµes de gravaÃ§Ã£o -->
      <div class="mt-2">
        <button type="button" class="btn btn-sm btn-outline-primary" id="startRecord">ğŸ™ï¸ Gravar Ãudio</button>
        <button type="button" class="btn btn-sm btn-outline-danger" id="stopRecord" disabled>â¹ï¸ Parar</button>
        <audio id="audioPreview" class="mt-3" controls style="display:none;"></audio>
        <input type="hidden" id="audioBase64" name="audioBase64">
      </div>
    </div>

    <!-- Resto do formulÃ¡rio omitido aqui por brevidade, mas vocÃª pode colar o restante do seu formulÃ¡rio original -->

    <!-- BotÃ£o final -->
    <button type="submit" class="btn btn-success">âœ… Enviar</button>
  </form>
</div>

<!-- Bootstrap + Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const startBtn = document.getElementById('startRecord');
  const stopBtn = document.getElementById('stopRecord');
  const audioPreview = document.getElementById('audioPreview');
  const audioInput = document.getElementById('audioBase64');
  let mediaRecorder, audioChunks = [];

  startBtn.addEventListener('click', async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();
    audioChunks = [];

    mediaRecorder.addEventListener("dataavailable", event => {
      audioChunks.push(event.data);
    });

    mediaRecorder.addEventListener("stop", () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      const audioUrl = URL.createObjectURL(audioBlob);
      audioPreview.src = audioUrl;
      audioPreview.style.display = "block";

      // Opcional: converter para base64 e enviar no formulÃ¡rio
      const reader = new FileReader();
      reader.onloadend = () => {
        audioInput.value = reader.result;
      };
      reader.readAsDataURL(audioBlob);
    });

    startBtn.disabled = true;
    stopBtn.disabled = false;
  });

  stopBtn.addEventListener('click', () => {
    mediaRecorder.stop();
    startBtn.disabled = false;
    stopBtn.disabled = true;
  });

  // ValidaÃ§Ã£o Bootstrap
  (() => {
    'use strict';
    const form = document.getElementById('formProblema');
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  })();
</script>
</body>
</html>
